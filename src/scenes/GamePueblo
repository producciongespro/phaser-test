import { Scene } from "phaser";
export default class GamePueblo extends Scene {
  constructor() {
    super("GamePueblo");
    this.currentPlayer1 = true;
  }

  create() {
    this.directSpeed = 4.5;
    this.cameras.main.setBounds(0, 0, 5000, 2813);

    this.add.image(0, 0, "fondo1").setOrigin(0);

    this.add.image(100, 250, "macha").setScale(0.3, 0.3);
    this.add.image(350, 250, "mago").setScale(0.6, 0.6);

    // Cambia a physics.add.image para que la cámara siga al player1
    this.player1 = this.physics.add.image(500, 250, "lechero").setScale(0.6);
    this.player2 = this.physics.add.image(200, 250, "verdurera").setScale(0.6);

    this.cursors = this.input.keyboard.createCursorKeys();
    this.key = this.input.keyboard.addKey("C");

    this.cameras.main.startFollow(this.player1, true); // Inicia siguiendo a player1
    this.cameras.main.setZoom(0.6);
  }

  update() {
    // Mover al jugador enfocado
    if (this.currentPlayer1) {
      this.movePlayer1();
    } else {
      this.movePlayer2();
    }

    // Actualizar el jugador enfocado al presionar 'C'
    this.updateChangePlayer();
  }

  updateChangePlayer() {
    if (Phaser.Input.Keyboard.JustDown(this.key)) { // Asegúrate de usar 'JustDown' para detectar la tecla solo una vez
      this.currentPlayer1 = !this.currentPlayer1;

      if (this.currentPlayer1) {
        this.cameras.main.startFollow(this.player1, true); // Seguir a player1
      } else {
        this.cameras.main.startFollow(this.player2, true); // Seguir a player2
      }

      console.log("Jugador actual:", this.currentPlayer1 ? "player1" : "player2");
    }
  }

  movePlayer1() {
    if (this.cursors.left.isDown) {
      this.player1.x -= this.directSpeed;
    } else if (this.cursors.right.isDown) {
      this.player1.x += this.directSpeed;
    }

    if (this.cursors.up.isDown) {
      this.player1.y -= this.directSpeed;
    } else if (this.cursors.down.isDown) {
      this.player1.y += this.directSpeed;
    }
  }

  movePlayer2() {
    if (this.cursors.left.isDown) {
      this.player2.x -= this.directSpeed;
    } else if (this.cursors.right.isDown) {
      this.player2.x += this.directSpeed;
    }

    if (this.cursors.up.isDown) {
      this.player2.y -= this.directSpeed;
    } else if (this.cursors.down.isDown) {
      this.player2.y += this.directSpeed;
    }
  }
}
